<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Navigation Fix Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background: linear-gradient(135deg, #1e3a8a, #7c3aed);
        color: white;
        min-height: 100vh;
      }
      .container {
        max-width: 1000px;
        margin: 0 auto;
        padding: 20px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        backdrop-filter: blur(10px);
      }
      .button {
        background: #ef4444;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        margin: 10px;
        font-size: 16px;
        transition: all 0.3s;
      }
      .button:hover {
        background: #dc2626;
        transform: translateY(-2px);
      }
      .button.success {
        background: #10b981;
      }
      .button.success:hover {
        background: #059669;
      }
      .status {
        background: rgba(0, 0, 0, 0.3);
        padding: 15px;
        border-radius: 8px;
        margin: 20px 0;
        font-family: monospace;
      }
      .log {
        background: rgba(0, 0, 0, 0.5);
        padding: 10px;
        border-radius: 5px;
        margin: 10px 0;
        max-height: 400px;
        overflow-y: auto;
        font-family: monospace;
        font-size: 12px;
      }
      .success {
        color: #10b981;
      }
      .error {
        color: #ef4444;
      }
      .info {
        color: #3b82f6;
      }
      .warning {
        color: #f59e0b;
      }
      .test-section {
        background: rgba(255, 255, 255, 0.05);
        padding: 15px;
        border-radius: 8px;
        margin: 15px 0;
      }
      .iframe-container {
        width: 100%;
        height: 600px;
        border: 2px solid rgba(255, 255, 255, 0.2);
        border-radius: 8px;
        overflow: hidden;
        margin: 20px 0;
      }
      iframe {
        width: 100%;
        height: 100%;
        border: none;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸš¨ Emergency Guardian - Navigation Fix Test</h1>

      <div class="status">
        <h3>Test Status</h3>
        <p>Frontend Server: <span id="frontend-status">æ£€æµ‹ä¸­...</span></p>
        <p>Navigation Fix: <span id="nav-fix-status">æœªæµ‹è¯•</span></p>
        <p>Current Time: <span id="current-time">-</span></p>
      </div>

      <div class="test-section">
        <h3>ğŸ”§ Navigation Fix Applied</h3>
        <p>å·²åº”ç”¨ä»¥ä¸‹ä¿®å¤:</p>
        <ul>
          <li>âœ… ä¿®å¤äº† useRouter hook ä¸­çš„æ— é™é‡æ¸²æŸ“é—®é¢˜</li>
          <li>âœ… æ·»åŠ äº† renderKey å¼ºåˆ¶é‡æ–°æ¸²æŸ“æœºåˆ¶</li>
          <li>âœ… ä¼˜åŒ–äº† navigate å‡½æ•°çš„çŠ¶æ€æ›´æ–°é¡ºåº</li>
          <li>âœ… åœ¨ App.tsx ä¸­æ·»åŠ äº† key prop å¼ºåˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“</li>
        </ul>
      </div>

      <div class="test-section">
        <h3>ğŸ§ª Test Actions</h3>
        <button class="button" onclick="testFrontendAccess()">
          æµ‹è¯•å‰ç«¯è®¿é—®
        </button>
        <button class="button" onclick="testDirectEmergencyPage()">
          æµ‹è¯•ç›´æ¥è®¿é—®ç´§æ€¥é¡µé¢
        </button>
        <button class="button success" onclick="openMainApp()">
          æ‰“å¼€ä¸»åº”ç”¨æµ‹è¯•å¯¼èˆª
        </button>
        <button class="button" onclick="clearLogs()">æ¸…é™¤æ—¥å¿—</button>
      </div>

      <div class="test-section">
        <h3>ğŸ“‹ Test Instructions</h3>
        <ol>
          <li>ç‚¹å‡» "æ‰“å¼€ä¸»åº”ç”¨æµ‹è¯•å¯¼èˆª" æŒ‰é’®</li>
          <li>åœ¨æ–°æ‰“å¼€çš„æ ‡ç­¾é¡µä¸­ï¼Œç‚¹å‡» "ç´§æ€¥æ±‚åŠ©" æŒ‰é’®</li>
          <li>æ£€æŸ¥é¡µé¢æ˜¯å¦æ­£ç¡®åˆ‡æ¢åˆ°ç´§æ€¥æ±‚åŠ©é¡µé¢</li>
          <li>æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°çš„æ—¥å¿—è¾“å‡º</li>
          <li>æµ‹è¯•å…¶ä»–å¯¼èˆªæŒ‰é’®ï¼ˆç›‘æŠ¤äººã€è®¾ç½®ç­‰ï¼‰</li>
        </ol>
      </div>

      <div class="test-section">
        <h3>ğŸ” Expected Behavior</h3>
        <p><strong>ä¿®å¤å‰:</strong> ç‚¹å‡»æŒ‰é’®åURLä¼šå˜åŒ–ï¼Œä½†é¡µé¢å†…å®¹ä¸ä¼šæ›´æ–°</p>
        <p><strong>ä¿®å¤å:</strong> ç‚¹å‡»æŒ‰é’®åURLå˜åŒ–ï¼Œé¡µé¢å†…å®¹ä¹Ÿä¼šæ­£ç¡®æ›´æ–°</p>
      </div>

      <div class="log" id="log"></div>

      <div class="test-section">
        <h3>ğŸ“± Embedded Test (Optional)</h3>
        <p>å¦‚æœéœ€è¦ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹iframeä¸­ç›´æ¥æµ‹è¯•:</p>
        <div class="iframe-container">
          <iframe id="test-iframe" src="about:blank"></iframe>
        </div>
        <button class="button" onclick="loadMainAppInIframe()">
          åœ¨iframeä¸­åŠ è½½ä¸»åº”ç”¨
        </button>
      </div>
    </div>

    <script>
      let logElement = document.getElementById("log");

      function log(message, type = "info") {
        const timestamp = new Date().toLocaleTimeString();
        const logEntry = document.createElement("div");
        logEntry.className = type;
        logEntry.textContent = `[${timestamp}] ${message}`;
        logElement.appendChild(logEntry);
        logElement.scrollTop = logElement.scrollHeight;
        console.log(`[${type.toUpperCase()}] ${message}`);
      }

      function clearLogs() {
        logElement.innerHTML = "";
        log("æ—¥å¿—å·²æ¸…é™¤", "info");
      }

      function updateTime() {
        document.getElementById("current-time").textContent =
          new Date().toLocaleTimeString();
      }

      async function testFrontendAccess() {
        log("æµ‹è¯•å‰ç«¯æœåŠ¡å™¨è®¿é—®...", "info");

        try {
          const response = await fetch("http://localhost:5173/");
          if (response.ok) {
            document.getElementById("frontend-status").textContent =
              "è¿è¡Œä¸­ âœ…";
            document.getElementById("frontend-status").className = "success";
            log("å‰ç«¯æœåŠ¡å™¨è®¿é—®æˆåŠŸ", "success");
            return true;
          } else {
            document.getElementById(
              "frontend-status"
            ).textContent = `é”™è¯¯ ${response.status} âŒ`;
            document.getElementById("frontend-status").className = "error";
            log(`å‰ç«¯æœåŠ¡å™¨è¿”å›é”™è¯¯: ${response.status}`, "error");
            return false;
          }
        } catch (error) {
          document.getElementById("frontend-status").textContent = "ç¦»çº¿ âŒ";
          document.getElementById("frontend-status").className = "error";
          log(`å‰ç«¯æœåŠ¡å™¨æ— æ³•è®¿é—®: ${error.message}`, "error");
          log('è¯·ç¡®ä¿è¿è¡Œäº† "npm run dev" å‘½ä»¤', "warning");
          return false;
        }
      }

      async function testDirectEmergencyPage() {
        log("æµ‹è¯•ç›´æ¥è®¿é—®ç´§æ€¥é¡µé¢...", "info");

        const isServerRunning = await testFrontendAccess();
        if (!isServerRunning) {
          log("å‰ç«¯æœåŠ¡å™¨æœªè¿è¡Œï¼Œè·³è¿‡æµ‹è¯•", "warning");
          return;
        }

        try {
          const emergencyUrl = "http://localhost:5173/emergency";
          log(`å°è¯•è®¿é—®: ${emergencyUrl}`, "info");

          const response = await fetch(emergencyUrl);
          if (response.ok) {
            log("ç´§æ€¥é¡µé¢ç›´æ¥è®¿é—®æˆåŠŸ", "success");

            // Open in new tab
            const newWindow = window.open(emergencyUrl, "_blank");
            if (newWindow) {
              log("ç´§æ€¥é¡µé¢å·²åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€", "success");
            } else {
              log("æ— æ³•æ‰“å¼€æ–°æ ‡ç­¾é¡µï¼ˆå¯èƒ½è¢«æµè§ˆå™¨é˜»æ­¢ï¼‰", "warning");
            }
          } else {
            log(`ç´§æ€¥é¡µé¢è®¿é—®å¤±è´¥: ${response.status}`, "error");
          }
        } catch (error) {
          log(`ç´§æ€¥é¡µé¢æµ‹è¯•å¤±è´¥: ${error.message}`, "error");
        }
      }

      async function openMainApp() {
        log("æ‰“å¼€ä¸»åº”ç”¨è¿›è¡Œå¯¼èˆªæµ‹è¯•...", "info");

        const isServerRunning = await testFrontendAccess();
        if (!isServerRunning) {
          log("å‰ç«¯æœåŠ¡å™¨æœªè¿è¡Œï¼Œæ— æ³•æ‰“å¼€ä¸»åº”ç”¨", "error");
          return;
        }

        try {
          const mainAppUrl = "http://localhost:5173/";
          log(`æ‰“å¼€ä¸»åº”ç”¨: ${mainAppUrl}`, "info");

          const newWindow = window.open(mainAppUrl, "_blank");
          if (newWindow) {
            log("ä¸»åº”ç”¨å·²åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€", "success");
            log("è¯·åœ¨æ–°æ ‡ç­¾é¡µä¸­æµ‹è¯•ä»¥ä¸‹åŠŸèƒ½:", "info");
            log('1. ç‚¹å‡» "ç´§æ€¥æ±‚åŠ©" æŒ‰é’®', "info");
            log("2. æ£€æŸ¥é¡µé¢æ˜¯å¦åˆ‡æ¢åˆ°ç´§æ€¥æ±‚åŠ©é¡µé¢", "info");
            log("3. æµ‹è¯•å…¶ä»–å¯¼èˆªæŒ‰é’®", "info");
            log("4. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°çš„æ—¥å¿—è¾“å‡º", "info");

            document.getElementById("nav-fix-status").textContent =
              "æµ‹è¯•ä¸­... è¯·æ£€æŸ¥æ–°æ ‡ç­¾é¡µ";
            document.getElementById("nav-fix-status").className = "warning";
          } else {
            log("æ— æ³•æ‰“å¼€æ–°æ ‡ç­¾é¡µï¼ˆå¯èƒ½è¢«æµè§ˆå™¨é˜»æ­¢ï¼‰", "error");
            log("è¯·æ‰‹åŠ¨è®¿é—®: http://localhost:5173/", "info");
          }
        } catch (error) {
          log(`æ‰“å¼€ä¸»åº”ç”¨å¤±è´¥: ${error.message}`, "error");
        }
      }

      function loadMainAppInIframe() {
        log("åœ¨iframeä¸­åŠ è½½ä¸»åº”ç”¨...", "info");

        const iframe = document.getElementById("test-iframe");
        iframe.src = "http://localhost:5173/";

        iframe.onload = () => {
          log("ä¸»åº”ç”¨å·²åœ¨iframeä¸­åŠ è½½", "success");
          log("æ³¨æ„: iframeä¸­çš„å¯¼èˆªå¯èƒ½å—åˆ°é™åˆ¶", "warning");
        };

        iframe.onerror = () => {
          log("iframeåŠ è½½å¤±è´¥", "error");
        };
      }

      // Initialize
      window.addEventListener("load", () => {
        log("Navigation Fix Test é¡µé¢å·²åŠ è½½", "info");
        log("å¼€å§‹æ£€æµ‹å‰ç«¯æœåŠ¡å™¨çŠ¶æ€...", "info");

        updateTime();
        setInterval(updateTime, 1000);

        // Auto-test frontend access
        setTimeout(testFrontendAccess, 1000);
      });
    </script>
  </body>
</html>
